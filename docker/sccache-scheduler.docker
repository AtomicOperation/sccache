ARG base=ubuntu:20.04

FROM sccache as builder

FROM ${base}
USER root

RUN apt update
RUN apt install -y libssl1.1 --no-install-recommends
RUN apt install bubblewrap

WORKDIR /opt/sccache
COPY --from=builder /usr/src/sccache/target/release/sccache-dist sccache-dist
COPY scheduler.conf scheduler.conf

EXPOSE 10600
ENV SCCACHE_NO_DAEMON=1
ENV RUST_LOG=warn

STOPSIGNAL SIGINT
ENTRYPOINT [ "/opt/sccache/sccache-dist", "scheduler", "--config", "scheduler.conf" ]
