ARG base=ubuntu:20.04

FROM sccache as builder

FROM ${base}
USER root

RUN apt update
RUN apt install -y libssl1.1 --no-install-recommends
RUN apt install bubblewrap

WORKDIR /opt/sccache
COPY --from=builder /usr/src/sccache/target/release/sccache-dist sccache-dist
COPY server.conf server.conf
COPY sccache-server.sh sccache-server.sh
RUN chmod +x sccache-server.sh

EXPOSE 10501
ENV SCCACHE_NO_DAEMON=1
ENV RUST_LOG=trace 

STOPSIGNAL SIGINT
ENTRYPOINT [ "/opt/sccache/sccache-server.sh" ]
